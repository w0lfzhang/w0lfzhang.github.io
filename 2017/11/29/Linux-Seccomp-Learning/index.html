<!DOCTYPE html>
<html>
    
    
        <body class="post-body">
    
    
<header class="header">

    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- post页的toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/" >fi3ework&#39;s Studio.</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">Linux Seccomp Learning</a>
            </div>
    </div>
    
    <a class="home-link" href=/>fi3ework's Studio.</a>
</header>
    <div class="wrapper">
        <div class="site-intro">
    
    <!-- 主页  -->
    
    
    <!-- 404页  -->
            
    <div class="site-intro-img" style="background-image: url(http://oumn0o088.bkt.clouddn.com/post-bg.jpg)"></div>
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
            Linux Seccomp Learning
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- 文章页meta -->
        
            <!-- 文章页标签  -->
            
                <div class= post-intro-tags >
    
        <a class="post-tag" href="javascript:void(0);" data-href = syscall>syscall</a>
    
        <a class="post-tag" href="javascript:void(0);" data-href = seccomp>seccomp</a>
    
</div>
            
            <div class="post-intro-meta">
                <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                <span class="post-intro-time">2017/11/29</span>
            </div>
        
    </div>
</div>
        <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <script>
            var browser = {
                    versions: function () {
                        var u = window.navigator.userAgent;
                        return {
                            userAgent: u,
                            trident: u.indexOf('Trident') > -1, //IE内核
                            presto: u.indexOf('Presto') > -1, //opera内核
                            webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
                            gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
                            mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
                            ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
                            android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
                            iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
                            iPad: u.indexOf('iPad') > -1, //是否为iPad
                            webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
                            weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
                            uc: u.indexOf('UCBrowser') > -1 //是否为android下的UC浏览器
                        };
                    }()
                }

            function fontLoaded(){
                console.log('font loaded');
                if (document.getElementsByClassName('site-intro-meta')) {
                    document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
                    document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
                    var postIntroTags = document.getElementsByClassName('post-intro-tags')[0],
                        postIntroMeat = document.getElementsByClassName('post-intro-meta')[0];
                        if (postIntroTags) {
                            postIntroTags.classList.add('post-fade-in');
                        }
                        if (postIntroMeat) {
                            postIntroMeat.classList.add('post-fade-in');
                        }
                    }
                }
                
            console.log("userAgent:" + browser.versions.userAgent);
            // UC不支持跨域，所以直接显示
            if (browser.versions.uc) {
                console.log("UCBrowser");
                fontLoaded();
            } else {
                WebFont.load({
                    custom: {
                        families: ['Oswald-Regular']
                    },
                    loading: function () {  //所有字体开始加载
                        // console.log('loading');
                    },
                    active: function () {  //所有字体已渲染
                        fontLoaded();
                    },
                    inactive: function () { //字体预加载失败，无效字体或浏览器不支持加载
                        console.log('inactive: timeout');
                        fontLoaded();
                    },
                    timeout: 7000 // Set the timeout to two seconds
                });
            }
        </script>
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <p>It’s been a long time since I wrote my last blog. Lazy and busy! </p>
<h2 id="What-is-seccomp"><a href="#What-is-seccomp" class="headerlink" title="What is seccomp"></a>What is seccomp</h2><p>seccomp (short for secure computing mode) is a computer security facility in the Linux kernel which was merged into the Linux kernel mainline in kernel version 2.6.12. As we all know, plenty of system calls are exposed to the programs directly, but not all system calls are needed to the users, which will be dangerous if someone abuses the system calls. By using seccomp, we can limit the program to use the specific system calls, which can make the system more secure.<br><a id="more"></a></p>
<h2 id="How-to-use-it"><a href="#How-to-use-it" class="headerlink" title="How to use it"></a>How to use it</h2><p>seccomp mode can be enabled via the prctl(2) system call using the PR_SET_SECCOMP argument, or (since Linux kernel 3.17[4]) via the seccomp(2) system call and the prerequisite is the kernel is configured with CONFIG_SECCOMP and CONFIG_SECCOMP_FILTER. seccomp mode used to be enabled by writing to a file, /proc/self/seccomp, but this method was removed in favor of prctl().<br>seccomp supports two modes: SECCOMP_MODE_STRICT and SECCOMP_MODE_FILTER. In SECCOMP_MODE_STRICT, it cannot use any system calls except exit(), sigreturn(), read() and write().<br>Have a look at the <a href="http://elixir.free-electrons.com/linux/v3.13.1/source/kernel/seccomp.c#L377" target="_blank" rel="external">kernel source code</a>:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">int</span> __secure_computing(<span class="keyword">int</span> this_syscall)</div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> mode = current-&gt;seccomp.mode;</div><div class="line">	<span class="keyword">int</span> exit_sig = <span class="number">0</span>;</div><div class="line">	<span class="keyword">int</span> *syscall;</div><div class="line">	u32 ret;</div><div class="line"></div><div class="line">	<span class="keyword">switch</span> (mode) &#123;</div><div class="line">	<span class="keyword">case</span> SECCOMP_MODE_STRICT:</div><div class="line">		syscall = mode1_syscalls;</div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_COMPAT</span></div><div class="line">		<span class="keyword">if</span> (is_compat_task())</div><div class="line">			syscall = mode1_syscalls_32;</div><div class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></div><div class="line">		<span class="keyword">do</span> &#123;</div><div class="line">			<span class="keyword">if</span> (*syscall == this_syscall)</div><div class="line">				<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">		&#125; <span class="keyword">while</span> (*++syscall);</div><div class="line">		exit_sig = SIGKILL;</div><div class="line">		ret = SECCOMP_RET_KILL;</div><div class="line">		<span class="keyword">break</span>;</div><div class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_SECCOMP_FILTER</span></div><div class="line">	<span class="keyword">case</span> SECCOMP_MODE_FILTER: &#123;</div><div class="line">		......</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>model_syscalls is the array including the syscall numbers of exit(), sigreturn(), read() and write().<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">int</span> mode1_syscalls[] = &#123;</div><div class="line">	__NR_seccomp_read, __NR_seccomp_write, __NR_seccomp_exit, __NR_seccomp_sigreturn,</div><div class="line">	<span class="number">0</span>, <span class="comment">/* null terminated */</span></div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>In SECCOMP_MODE_FILTER, since linux 3.5, it is possible to define advanced custom filters based on the BPF (Berkley Packet Filters) to limit what system calls and their arguments can be used by the process. In this mode, the caller must have the CAP_SYS_ADMIN ability or the thread must have been set <a href="https://www.kernel.org/doc/Documentation/prctl/no_new_privs.txt" target="_blank" rel="external">no_new_privs</a>.<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">case</span> SECCOMP_MODE_FILTER: &#123;</div><div class="line">		<span class="keyword">int</span> data;</div><div class="line">		<span class="class"><span class="keyword">struct</span> <span class="title">pt_regs</span> *<span class="title">regs</span> = <span class="title">task_pt_regs</span>(<span class="title">current</span>);</span></div><div class="line">		ret = seccomp_run_filters(this_syscall);</div><div class="line">		data = ret &amp; SECCOMP_RET_DATA;</div><div class="line">		ret &amp;= SECCOMP_RET_ACTION;</div><div class="line">		<span class="keyword">switch</span> (ret) &#123;</div><div class="line">		<span class="keyword">case</span> SECCOMP_RET_ERRNO:</div><div class="line">			<span class="comment">/* Set the low-order 16-bits as a errno. */</span></div><div class="line">			syscall_set_return_value(current, regs,</div><div class="line">						 -data, <span class="number">0</span>);</div><div class="line">			<span class="keyword">goto</span> skip;</div><div class="line">		<span class="keyword">case</span> SECCOMP_RET_TRAP:</div><div class="line">			<span class="comment">/* Show the handler the original registers. */</span></div><div class="line">			syscall_rollback(current, regs);</div><div class="line">			<span class="comment">/* Let the filter pass back 16 bits of data. */</span></div><div class="line">			seccomp_send_sigsys(this_syscall, data);</div><div class="line">			<span class="keyword">goto</span> skip;</div><div class="line">		<span class="keyword">case</span> SECCOMP_RET_TRACE:</div><div class="line">			<span class="comment">/* Skip these calls if there is no tracer. */</span></div><div class="line">			<span class="keyword">if</span> (!ptrace_event_enabled(current, PTRACE_EVENT_SECCOMP)) &#123;</div><div class="line">				syscall_set_return_value(current, regs,</div><div class="line">							 -ENOSYS, <span class="number">0</span>);</div><div class="line">				<span class="keyword">goto</span> skip;</div><div class="line">			&#125;</div><div class="line">			<span class="comment">/* Allow the BPF to provide the event message */</span></div><div class="line">			ptrace_event(PTRACE_EVENT_SECCOMP, data);</div><div class="line">			<span class="comment">/*</span></div><div class="line">			 * The delivery of a fatal signal during event</div><div class="line">			 * notification may silently skip tracer notification.</div><div class="line">			 * Terminating the task now avoids executing a system</div><div class="line">			 * call that may not be intended.</div><div class="line">			 */</div><div class="line">			<span class="keyword">if</span> (fatal_signal_pending(current))</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">			<span class="keyword">if</span> (syscall_get_nr(current, regs) &lt; <span class="number">0</span>)</div><div class="line">				<span class="keyword">goto</span> skip;  <span class="comment">/* Explicit request to skip. */</span></div><div class="line"></div><div class="line">			<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">		<span class="keyword">case</span> SECCOMP_RET_ALLOW:</div><div class="line">			<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">		<span class="keyword">case</span> SECCOMP_RET_KILL:</div><div class="line">		<span class="keyword">default</span>:</div><div class="line">			<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">		exit_sig = SIGSYS;</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line"><span class="comment">/* Masks for the return value sections. */</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SECCOMP_RET_ACTION	0x7fff0000U</span></div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SECCOMP_RET_DATA	0x0000ffffU</span></div></pre></td></tr></table></figure></p>
<p>Each syscall is sent to the filter which tells what action to take:</p>
<ol>
<li>SECCOMP_RET_KILL: Immediate kill with SIGSYS</li>
<li>SECCOMP_RET_TRAP: Send a catchable SIGSYS, giving a chance to emulate the syscall</li>
<li>SECCOMP_RET_ERRNO: Force errno value</li>
<li>SECCOMP_RET_TRACE: Yield decision to ptracer or set errno to -ENOSYS</li>
<li>SECCOMP_RET_ALLOW: Allow</li>
</ol>
<p>In the code, seccomp_run_filters returns valid seccomp BPF response codes. And then choose what to do according to ‘ret’. Of course we can control the ‘response codes’ in user space through seecomp or prctl syscall.</p>
<p>Last, we can see if seccomp is set via read the file /proc/<pid>/status:<br>0: closed.<br>1: in STRICT mode.<br>2: in FILTER mode.<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">w0lfzhang@w0lfzhang666:~/Desktop/linux-security$ cat /proc/1/status | grep Seccomp</div><div class="line">Seccomp:	0</div></pre></td></tr></table></figure></pid></p>
<h2 id="Demos-to-show"><a href="#Demos-to-show" class="headerlink" title="Demos to show"></a>Demos to show</h2><h3 id="SECCOMP-MODE-STRICT"><a href="#SECCOMP-MODE-STRICT" class="headerlink" title="SECCOMP_MODE_STRICT"></a>SECCOMP_MODE_STRICT</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;         /* printf */</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/prctl.h&gt;     /* prctl */</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;linux/seccomp.h&gt; /* seccomp's constants */</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;        /* dup2: just for test */</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"step 1: unrestricted\n"</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Enable filtering</span></div><div class="line">  prctl(PR_SET_SECCOMP, SECCOMP_MODE_STRICT);</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"step 2: only 'read', 'write', 'exit' and 'sigreturn' syscalls\n"</span>);</div><div class="line">  </div><div class="line">  <span class="comment">// Redirect stderr to stdout</span></div><div class="line">  dup2(<span class="number">1</span>, <span class="number">2</span>);</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"step 3: !! YOU SHOULD NOT SEE ME !!\n"</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Success (well, not so in this case...)</span></div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>When running the program:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">w0lfzhang@w0lfzhang666:~/Desktop/linux-security$ ./seccomp1 </div><div class="line">step 1: unrestricted</div><div class="line">step 2: only 'read', 'write', '_exit' and 'sigreturn' syscalls</div><div class="line">Killed</div></pre></td></tr></table></figure></p>
<p>So it’s apparent when a forbidden syscall is issued, the program is immediately killed.</p>
<h3 id="SECCOMP-MODE-FILTER"><a href="#SECCOMP-MODE-FILTER" class="headerlink" title="SECCOMP_MODE_FILTER"></a>SECCOMP_MODE_FILTER</h3><p>We can use libseccomp to simplify our work:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install libseccomp-dev</div></pre></td></tr></table></figure></p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;   /* printf */</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;  /* dup2: just for test */</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;seccomp.h&gt; /* libseccomp */</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"step 1: unrestricted\n"</span>);</div><div class="line"></div><div class="line">  <span class="comment">// ensure none of our children will ever be granted more priv</span></div><div class="line">  <span class="comment">// (via setuid, capabilities, ...)</span></div><div class="line">  prctl(PR_SET_NO_NEW_PRIVS, <span class="number">1</span>);</div><div class="line">  <span class="comment">// ensure no escape is possible via ptrace</span></div><div class="line">  prctl(PR_SET_DUMPABLE, <span class="number">0</span>);</div><div class="line">  </div><div class="line">  <span class="comment">// Init the filter</span></div><div class="line">  scmp_filter_ctx ctx;</div><div class="line">  ctx = seccomp_init(SCMP_ACT_KILL); <span class="comment">// default action: kill</span></div><div class="line"></div><div class="line">  <span class="comment">// setup basic whitelist</span></div><div class="line">  seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(rt_sigreturn), <span class="number">0</span>);</div><div class="line">  seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(<span class="built_in">exit</span>), <span class="number">0</span>);</div><div class="line">  seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(read), <span class="number">0</span>);</div><div class="line">  seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(write), <span class="number">0</span>);</div><div class="line">  </div><div class="line">  <span class="comment">// setup our rule</span></div><div class="line">  seccomp_rule_add(ctx, SCMP_ACT_ALLOW, SCMP_SYS(dup2), <span class="number">2</span>, </div><div class="line">                        SCMP_A0(SCMP_CMP_EQ, <span class="number">1</span>),</div><div class="line">                        SCMP_A1(SCMP_CMP_EQ, <span class="number">2</span>));</div><div class="line"></div><div class="line">  <span class="comment">// build and load the filter</span></div><div class="line">  seccomp_load(ctx);</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"step 2: only the whitelist and dup2(1, 2) syscalls\n"</span>);</div><div class="line"> </div><div class="line">  <span class="comment">// Redirect stderr to stdout</span></div><div class="line">  dup2(<span class="number">1</span>, <span class="number">2</span>);</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"step 3: stderr redirected to stdout\n"</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Duplicate stderr to arbitrary fd</span></div><div class="line">  dup2(<span class="number">2</span>, <span class="number">42</span>);</div><div class="line">  <span class="built_in">printf</span>(<span class="string">"step 4: !! YOU SHOULD NOT SEE ME !!\n"</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Success (well, not so in this case...)</span></div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>; </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Run the program:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">w0lfzhang@w0lfzhang666:~/Desktop/linux-security$ ./seccomp2</div><div class="line">step 1: unrestricted</div><div class="line">step 2: only the whitelist and dup2(1, 2) syscalls</div><div class="line">step 3: stderr redirected to stdout</div><div class="line">Bad system call</div></pre></td></tr></table></figure></p>
<h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><p><a href="https://blog.yadutaf.fr/2014/05/29/introduction-to-seccomp-bpf-linux-syscall-filter/" target="_blank" rel="external">Introduction to seccomp: BPF linux syscall filter</a><br><a href="https://szlin.me/2017/08/23/kernel_seccomp/" target="_blank" rel="external">seccomp 學習筆記</a><br><a href="http://man7.org/linux/man-pages/man2/seccomp.2.html" target="_blank" rel="external">SECCOMP(2) Linux Programmer’s Manual SECCOMP(2)</a></p>

    </article>
    <!-- 前后页  -->
    <ul class="post-pager">
        
            <li class="next">
                <a href= "/2017/11/30/Starting-fuzz-with-AFL/" title= Starting fuzz with AFL >
                    <span>Next Post</span>
                    <span>Starting fuzz with AFL</span>
                </a>
            </li>
        
        
            <li class="previous">
                <a href= "/2017/10/02/Splice-Syscall-Analysis-2/" title= Splice Syscall Analysis(2) >
                    <span>Previous Post</span>
                    <span>Splice Syscall Analysis(2)</span>
                </a>
            </li>
        
    </ul>
    <!-- 评论插件 -->
    <!-- 来必力City版安装代码 -->

<!-- City版安装代码已完成 -->
    
    
    <!--PC版-->

    <!--PC版-->


    
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:12345@qq.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/fi3ework" class="iconfont-archer github" target="_blank" title="github"></a>
            
        
    
        
    
        
            
                <a href="/atom.xml" class="iconfont-archer rss" target="_blank" title="rss"></a>
            
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">Theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">archer</a></span>
    </div>
    <!-- 不蒜子  -->
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper">
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-seccomp"><span class="toc-number">1.</span> <span class="toc-text">What is seccomp</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-to-use-it"><span class="toc-number">2.</span> <span class="toc-text">How to use it</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Demos-to-show"><span class="toc-number">3.</span> <span class="toc-text">Demos to show</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SECCOMP-MODE-STRICT"><span class="toc-number">3.1.</span> <span class="toc-text">SECCOMP_MODE_STRICT</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SECCOMP-MODE-FILTER"><span class="toc-number">3.2.</span> <span class="toc-text">SECCOMP_MODE_FILTER</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Links"><span class="toc-number">4.</span> <span class="toc-text">Links</span></a></li></ol>
    </div>
    
    <div class="back-top">&#xe639;</div>
    <div class="sidebar">
    <div class="sidebar-header sidebar-header-show-archive">
        <div class="sidebar-category">
            <span class="sidebar-archive-link"><span class="iconfont-archer">&#xe67d;</span>Archive</span>
            <span class="sidebar-tags-link"><span class="iconfont-archer">&#xe610;</span>Tag</span>
        </div>
    </div>
    <div class="sidebar-content sidebar-content-show-archive">
        
        <div class="sidebar-tags">
    <div class="sidebar-tags-name">
    
        <span class="sidebar-tag-name"><a href= "#">kernel exploit</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">ctf</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">kernel arbitrary write</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">kernel arbitrary read</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">off-by-one</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">ptmx</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">kernel UAF</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">rootkit</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">stack</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">canary</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">fortify</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">kernel arbitray write/read</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">overwrite cred</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">use-after-free</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">unsorted bin attack</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">fastbin unlink attack</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">PIE</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">RELRO</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">offset2libc</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">house-of-force</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">stackoverflow</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">IO redirect</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">dup & dup2</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">double free</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">unlink</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">malloc_consolidate</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">got_overwrite</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">format string vlun</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">fsb</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">DynELF</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">malloc_hook fastbins</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">fastbin attack</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">FILE stream pointer overflow</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">kernel build</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">stack pivot</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">ROP</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">stack overflow</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">syscall</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">libc-db</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">bypass mmap_min_addr</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">privilege escalation</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">ia32syscall</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">crypto</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">RSA</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">AES</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">windows</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">injection</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">kernel debug</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">LKM</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">null pointer</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">overflow</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">FSPO</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">_IO_list_all</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">hooing system</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">kernel rop</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">seccomp</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">slab</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">slub overflow</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">shmid_kernel</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">tty driver</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">tls_dtor_list</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">heap overflow</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">Linux Kernel</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">SROP</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">splice</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">socket & pipe</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">fuzzing</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">AFL</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">kernel basis</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">arm</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">assemble</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">heap</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">exploit</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">kernel memory leaking</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">stackjacking</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">Linux_Driver</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">ioctl</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">got overwrite</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">pwnable</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">stack_canary</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">c++</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">kernel_exploit</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">return to dl-resolve</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">inode</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">file_operations</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">compound pages</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">integer overflow</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">kernel write zero</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">clear_child_tid</a></span>
    
        <span class="sidebar-tag-name"><a href= "#">set_fs && KERNEL_DS</a></span>
    
    </div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    缺失模块。<br/>
    1、请确保node版本大于6.2<br/>
    2、在博客根目录（注意不是archer根目录）执行以下命令：<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3、在根目录_config.yml里添加配置：
    <pre style="color: #888; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: false
    tags: true</pre>
    </div> 
    <div class="sidebar-tag-list"></div>
</div>
    </div>
</div> 
    <script>
    var jsInfo = {
        root: '/'
    }
</script>
    <!-- 不蒜子  -->
    
    <!-- CNZZ统计  -->
    
    </div>
    </body>
</html>


